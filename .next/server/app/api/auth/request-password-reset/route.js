"use strict";(()=>{var e={};e.id=168,e.ids=[168],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},14979:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>h,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{POST:()=>c});var n=t(49303),i=t(88716),o=t(60670),a=t(87070),u=t(83493),d=t(84770),l=t.n(d),p=t(36119);async function c(e){try{let{email:r}=await e.json();if(!r)return a.NextResponse.json({message:"E-Mail-Adresse erforderlich"},{status:400});let t=r.toLowerCase().trim(),s=await u.Z.user.findUnique({where:{email:t}});if(s){let e=l().randomBytes(32).toString("hex"),r=l().createHash("sha256").update(e).digest("hex"),t=new Date(Date.now()+36e5);await u.Z.user.update({where:{id:s.id},data:{passwordResetToken:r,passwordResetExpires:t}});try{await (0,p.L)(s.email,e)}catch(e){return a.NextResponse.json({message:"Fehler beim Senden der E-Mail."},{status:500})}}else console.log(`Password reset request for non-existent email: ${t}`);return a.NextResponse.json({message:"Wenn ein Konto mit dieser E-Mail-Adresse existiert, wurde ein Link zum Zur\xfccksetzen des Passworts gesendet."})}catch(e){return console.error("Request password reset error:",e),a.NextResponse.json({message:"Interner Serverfehler"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/request-password-reset/route",pathname:"/api/auth/request-password-reset",filename:"route",bundlePath:"app/api/auth/request-password-reset/route"},resolvedPagePath:"/Users/schne1s/Documents/KI_PAGE/src/app/api/auth/request-password-reset/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:g}=h,m="/api/auth/request-password-reset/route";function w(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}},36119:(e,r,t)=>{t.d(r,{L:()=>a,l:()=>u});let s=t(55245).createTransport({host:process.env.EMAIL_SERVER_HOST,port:parseInt(process.env.EMAIL_SERVER_PORT||"587",10),secure:"465"===(process.env.EMAIL_SERVER_PORT||"465"),auth:{user:process.env.EMAIL_SERVER_USER,pass:process.env.EMAIL_SERVER_PASSWORD}}),n=process.env.EMAIL_FROM||'"LIGAManager" <noreply@volleyball-badberneck.de>',i="http://localhost:3000",o="LIGAManager";async function a(e,r){let t=`${i}/reset-password/${r}`,a={from:n,to:e,subject:`Passwort zur\xfccksetzen f\xfcr ${o}`,text:`Sie erhalten diese E-Mail, weil Sie (oder jemand anderes) das Zur\xfccksetzen des Passworts f\xfcr Ihr Konto bei ${o} angefordert haben.

Bitte klicken Sie auf den folgenden Link oder f\xfcgen Sie ihn in Ihren Browser ein, um den Vorgang abzuschlie\xdfen:

${t}

Wenn Sie dies nicht angefordert haben, ignorieren Sie diese E-Mail bitte und Ihr Passwort bleibt unver\xe4ndert.
Dieser Link ist eine Stunde lang g\xfcltig.
`,html:`<p>Sie erhalten diese E-Mail, weil Sie (oder jemand anderes) das Zur\xfccksetzen des Passworts f\xfcr Ihr Konto bei ${o} angefordert haben.</p><p>Bitte klicken Sie auf den folgenden Link, um den Vorgang abzuschlie\xdfen:</p><p><a href="${t}">${t}</a></p><p>Wenn Sie dies nicht angefordert haben, ignorieren Sie diese E-Mail bitte und Ihr Passwort bleibt unver\xe4ndert.</p><p>Dieser Link ist eine Stunde lang g\xfcltig.</p>`};try{await s.sendMail(a),console.log(`Password reset email sent successfully to ${e}`)}catch(r){throw console.error(`Error sending password reset email to ${e}:`,r),Error("Fehler beim Senden der Passwort-Reset-E-Mail.")}}async function u(e,r,t){let a=`${i}/set-password/${t}`,u={from:n,to:e,subject:`Ihr neues Konto bei ${o} wurde erstellt!`,text:`Hallo ${r},

ein Konto f\xfcr Sie wurde im ${o} erstellt.

Bitte klicken Sie auf den folgenden Link, um Ihr Passwort festzulegen und Ihr Konto zu aktivieren:

${a}

Dieser Link ist 72 Stunden (3 Tage) g\xfcltig.

Mit freundlichen Gr\xfc\xdfen,
Ihr ${o} Team`,html:`<p>Hallo ${r},</p><p>ein Konto f\xfcr Sie wurde im ${o} erstellt.</p><p>Bitte klicken Sie auf den folgenden Link, um Ihr Passwort festzulegen und Ihr Konto zu aktivieren:</p><p><a href="${a}">${a}</a></p><p>Dieser Link ist 72 Stunden (3 Tage) g\xfcltig.</p><p>Mit freundlichen Gr\xfc\xdfen,<br/>Ihr ${o} Team</p>`};try{await s.sendMail(u),console.log(`Account setup email sent successfully to ${e}`)}catch(r){throw console.error(`Error sending account setup email to ${e}:`,r),Error("Fehler beim Senden der Konto-Einrichtungs-E-Mail.")}}},83493:(e,r,t)=>{t.d(r,{Z:()=>i,_:()=>n});let s=require("@prisma/client"),n=globalThis.prisma??new s.PrismaClient({}),i=n}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,5245],()=>t(14979));module.exports=s})();