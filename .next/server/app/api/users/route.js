"use strict";(()=>{var e={};e.id=5701,e.ids=[5701],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},61282:e=>{e.exports=require("child_process")},84770:e=>{e.exports=require("crypto")},80665:e=>{e.exports=require("dns")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},53179:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>E,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>g,staticGenerationAsyncStorage:()=>x});var s={};t.r(s),t.d(s,{GET:()=>h,POST:()=>c});var n=t(49303),i=t(88716),a=t(60670),o=t(87070),u=t(83493),l=t(84770),d=t.n(l),p=t(36119);async function c(e){let{email:r,name:t,isAdmin:s=!1,teamIds:n}=await e.json();if(!r||!t)return o.NextResponse.json({message:"E-Mail und Name sind erforderlich."},{status:400});let i=r.toLowerCase().trim();try{if(await u.Z.user.findUnique({where:{email:i}}))return o.NextResponse.json({message:"Ein Benutzer mit dieser E-Mail-Adresse existiert bereits."},{status:409});let e=await u.Z.user.create({data:{email:i,name:t,isAdmin:s}});if(n&&n.length>0)for(let r of n.map(r=>({userId:e.id,teamId:r})))await u.Z.userTeam.create({data:r});let r=d().randomBytes(32).toString("hex"),a=d().createHash("sha256").update(r).digest("hex"),l=new Date(Date.now()+2592e5);try{await u.Z.user.update({where:{id:e.id},data:{passwordSetupToken:a,passwordSetupExpires:l}}),await (0,p.l)(e.email,e.name,r)}catch(e){return console.error("Fehler beim Speichern des Setup-Tokens oder Senden der E-Mail:",e),o.NextResponse.json({message:"Benutzer erstellt, aber Fehler bei der Einrichtung/E-Mail-Versand. Bitte manuell beheben."},{status:500})}let{passwordSetupToken:c,passwordSetupExpires:h,passwordResetToken:m,passwordResetExpires:f,...x}=e;return o.NextResponse.json(x,{status:201})}catch(e){if(console.error("Error creating user:",e),"P2002"===e.code)return o.NextResponse.json({message:"Ein Benutzer mit dieser E-Mail-Adresse existiert bereits."},{status:409});return o.NextResponse.json({message:"Fehler beim Erstellen des Benutzers"},{status:500})}}async function h(){try{let e=(await u.Z.user.findMany({include:{teams:{include:{team:{select:{id:!0,name:!0}}}}}})).map(e=>({...e,teams:e.teams.map(e=>({id:e.team.id,name:e.team.name}))}));return o.NextResponse.json(e)}catch(e){return console.error("Error fetching users:",e),o.NextResponse.json({message:"Fehler beim Abrufen der Benutzer"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/users/route",pathname:"/api/users",filename:"route",bundlePath:"app/api/users/route"},resolvedPagePath:"/Users/schne1s/Documents/KI_PAGE/src/app/api/users/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:x,serverHooks:g}=m,E="/api/users/route";function w(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:x})}},36119:(e,r,t)=>{t.d(r,{L:()=>o,l:()=>u});let s=t(55245).createTransport({host:process.env.EMAIL_SERVER_HOST,port:parseInt(process.env.EMAIL_SERVER_PORT||"587",10),secure:"465"===(process.env.EMAIL_SERVER_PORT||"465"),auth:{user:process.env.EMAIL_SERVER_USER,pass:process.env.EMAIL_SERVER_PASSWORD}}),n=process.env.EMAIL_FROM||'"LIGAManager" <noreply@volleyball-badberneck.de>',i="http://localhost:3000",a="LIGAManager";async function o(e,r){let t=`${i}/reset-password/${r}`,o={from:n,to:e,subject:`Passwort zur\xfccksetzen f\xfcr ${a}`,text:`Sie erhalten diese E-Mail, weil Sie (oder jemand anderes) das Zur\xfccksetzen des Passworts f\xfcr Ihr Konto bei ${a} angefordert haben.

Bitte klicken Sie auf den folgenden Link oder f\xfcgen Sie ihn in Ihren Browser ein, um den Vorgang abzuschlie\xdfen:

${t}

Wenn Sie dies nicht angefordert haben, ignorieren Sie diese E-Mail bitte und Ihr Passwort bleibt unver\xe4ndert.
Dieser Link ist eine Stunde lang g\xfcltig.
`,html:`<p>Sie erhalten diese E-Mail, weil Sie (oder jemand anderes) das Zur\xfccksetzen des Passworts f\xfcr Ihr Konto bei ${a} angefordert haben.</p><p>Bitte klicken Sie auf den folgenden Link, um den Vorgang abzuschlie\xdfen:</p><p><a href="${t}">${t}</a></p><p>Wenn Sie dies nicht angefordert haben, ignorieren Sie diese E-Mail bitte und Ihr Passwort bleibt unver\xe4ndert.</p><p>Dieser Link ist eine Stunde lang g\xfcltig.</p>`};try{await s.sendMail(o),console.log(`Password reset email sent successfully to ${e}`)}catch(r){throw console.error(`Error sending password reset email to ${e}:`,r),Error("Fehler beim Senden der Passwort-Reset-E-Mail.")}}async function u(e,r,t){let o=`${i}/set-password/${t}`,u={from:n,to:e,subject:`Ihr neues Konto bei ${a} wurde erstellt!`,text:`Hallo ${r},

ein Konto f\xfcr Sie wurde im ${a} erstellt.

Bitte klicken Sie auf den folgenden Link, um Ihr Passwort festzulegen und Ihr Konto zu aktivieren:

${o}

Dieser Link ist 72 Stunden (3 Tage) g\xfcltig.

Mit freundlichen Gr\xfc\xdfen,
Ihr ${a} Team`,html:`<p>Hallo ${r},</p><p>ein Konto f\xfcr Sie wurde im ${a} erstellt.</p><p>Bitte klicken Sie auf den folgenden Link, um Ihr Passwort festzulegen und Ihr Konto zu aktivieren:</p><p><a href="${o}">${o}</a></p><p>Dieser Link ist 72 Stunden (3 Tage) g\xfcltig.</p><p>Mit freundlichen Gr\xfc\xdfen,<br/>Ihr ${a} Team</p>`};try{await s.sendMail(u),console.log(`Account setup email sent successfully to ${e}`)}catch(r){throw console.error(`Error sending account setup email to ${e}:`,r),Error("Fehler beim Senden der Konto-Einrichtungs-E-Mail.")}}},83493:(e,r,t)=>{t.d(r,{Z:()=>i,_:()=>n});let s=require("@prisma/client"),n=globalThis.prisma??new s.PrismaClient({}),i=n}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[9276,5972,5245],()=>t(53179));module.exports=s})();