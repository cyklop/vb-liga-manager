(()=>{var e={};e.id=3847,e.ids=[3847],e.modules={67096:e=>{"use strict";e.exports=require("bcrypt")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{"use strict";e.exports=require("assert")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},86624:e=>{"use strict";e.exports=require("querystring")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},45595:(e,t,s)=>{"use strict";s.r(t),s.d(t,{originalPathname:()=>b,patchFetch:()=>q,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>w});var r={};s.r(r),s.d(r,{GET:()=>c,PUT:()=>x});var i=s(49303),a=s(88716),n=s(60670),u=s(87070),m=s(13538),o=s(42023),p=s.n(o),l=s(45609),d=s(95456);async function c(e){let t=await (0,l.getServerSession)(d.L);if(!t||!t.user?.id)return u.NextResponse.json({message:"Nicht authentifiziert"},{status:401});let s=parseInt(t.user.id);try{let e=await m.prisma.user.findUnique({where:{id:s},include:{teams:{include:{team:{select:{id:!0,name:!0}}}}}});if(!e)return u.NextResponse.json({message:"Benutzer nicht gefunden"},{status:404});let t={...e,teams:e.teams.map(e=>({id:e.team.id,name:e.team.name})),team:e.teams.length>0?{id:e.teams[0].team.id,name:e.teams[0].team.name}:null};return u.NextResponse.json(t)}catch(e){return console.error("Fehler beim Abrufen des Benutzerprofils:",e),u.NextResponse.json({message:"Ein Fehler ist aufgetreten"},{status:500})}}async function x(e){let t=await (0,l.getServerSession)(d.L);if(!t||!t.user?.id)return u.NextResponse.json({message:"Nicht authentifiziert"},{status:401});let s=parseInt(t.user.id),{name:r,email:i,password:a,theme:n}=await e.json();try{let e={name:r,email:i};if(a){let t=await p().hash(a,10);e.password=t}n&&(e.theme=n);let t=await m.prisma.user.update({where:{id:s},data:e,include:{teams:{include:{team:{select:{id:!0,name:!0}}}}}}),o={...t,teams:t.teams.map(e=>({id:e.team.id,name:e.team.name})),team:t.teams.length>0?{id:t.teams[0].team.id,name:t.teams[0].team.name}:null};return u.NextResponse.json(o)}catch(e){return console.error("Fehler beim Aktualisieren des Benutzerprofils:",e),u.NextResponse.json({message:"Ein Fehler ist aufgetreten"},{status:500})}}let h=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/users/me/route",pathname:"/api/users/me",filename:"route",bundlePath:"app/api/users/me/route"},resolvedPagePath:"/Users/schne1s/Documents/KI_PAGE/src/app/api/users/me/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:g,staticGenerationAsyncStorage:w,serverHooks:f}=h,b="/api/users/me/route";function q(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:w})}},95456:(e,t,s)=>{"use strict";s.d(t,{L:()=>u});var r=s(53797),i=s(67096),a=s.n(i),n=s(13538);let u={providers:[(0,r.Z)({name:"Credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"},rememberMe:{label:"Remember Me",type:"checkbox"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Bitte geben Sie E-Mail und Passwort ein");let t=e.email.toLowerCase().trim(),s=await n.prisma.user.findUnique({where:{email:t},include:{teams:{select:{team:{select:{id:!0,name:!0}}}}}});if(!s)throw Error("Benutzer nicht gefunden");if(!await a().compare(e.password,s.password))throw Error("Ung\xfcltiges Passwort");let r=s.teams.length>0?s.teams[0].team:null,i="true"===e.rememberMe||!0===e.rememberMe;return{id:s.id.toString(),email:s.email,name:s.name,isAdmin:s.isAdmin,isSuperAdmin:s.isSuperAdmin,team:r,rememberMe:i}}})],pages:{signIn:"/login",error:"/login"},callbacks:{jwt:async({token:e,user:t,trigger:s})=>("signIn"===s&&t&&(e.id=t.id,e.email=t.email,e.name=t.name,e.isAdmin=t.isAdmin,e.isSuperAdmin=t.isSuperAdmin,e.team=t.team,e.rememberMe=t.rememberMe),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id,e.user.email=t.email,e.user.name=t.name,e.user.isAdmin=t.isAdmin,e.user.isSuperAdmin=t.isSuperAdmin,e.user.team=t.team,e.user.rememberMe=t.rememberMe),e)},session:{strategy:"jwt",maxAge:2592e3},cookies:{sessionToken:{name:"__Secure-next-auth.session-token",options:{httpOnly:!0,sameSite:"lax",path:"/",secure:!0,maxAge:2592e3}}}}},13538:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[9276,5972,2857,2023],()=>s(45595));module.exports=r})();