"use strict";(()=>{var e={};e.id=2474,e.ids=[2474],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},87848:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>d,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>c});var o={};s.r(o),s.d(o,{GET:()=>u});var i=s(49303),n=s(88716),a=s(60670),r=s(87070),p=s(83493);async function u(e,{params:t}){let s=parseInt(t.id);if(isNaN(s))return r.NextResponse.json({message:"Ung\xfcltige Liga-ID"},{status:400});let o=new URL(e.url).searchParams.get("matchday"),i=o?parseInt(o):void 0;try{let e=await p.Z.league.findUnique({where:{id:s},include:{teams:!0}});if(!e)return r.NextResponse.json({message:"Liga nicht gefunden"},{status:404});let t={where:{leagueId:s,AND:[{homeSets:{not:null}},{awaySets:{not:null}}]},include:{homeTeam:{select:{id:!0,name:!0}},awayTeam:{select:{id:!0,name:!0}}}};void 0!==i&&t.where.AND.push({matchday:{lte:i}});let o=await p.Z.fixture.findMany(t),n={};e.teams.forEach(e=>{n[e.id]={teamId:e.id,teamName:e.name,played:0,won:0,lost:0,points:0,setsWon:0,setsLost:0,setsDiff:0,setsQuotient:0,pointsWon:0,pointsLost:0,pointsDiff:0,pointsQuotient:0,directComparisonWins:0,directComparisonLosses:0}}),o.forEach(t=>{let o=t.homeTeamId,i=t.awayTeamId;if(!n[o]||!n[i]){console.warn(`Fixture ${t.id} involves team not currently in league ${s} (Teams: ${o}, ${i}). Skipping fixture for table calculation.`);return}let a=t.homeSets||0,r=t.awaySets||0,p=t.homePoints||0,u=t.awayPoints||0;n[o].played++,n[i].played++,n[o].setsWon+=a,n[o].setsLost+=r,n[i].setsWon+=r,n[i].setsLost+=a,n[o].pointsWon+=p,n[o].pointsLost+=u,n[i].pointsWon+=u,n[i].pointsLost+=p,a>r?(n[o].won++,n[i].lost++,n[o].directComparisonWins++,n[i].directComparisonLosses++,3===a&&0===r?n[o].points+=e.pointsWin30:3===a&&1===r?n[o].points+=e.pointsWin31:3===a&&2===r&&(n[o].points+=e.pointsWin32,n[i].points+=e.pointsLoss32)):r>a&&(n[i].won++,n[o].lost++,n[i].directComparisonWins++,n[o].directComparisonLosses++,3===r&&0===a?n[i].points+=e.pointsWin30:3===r&&1===a?n[i].points+=e.pointsWin31:3===r&&2===a&&(n[i].points+=e.pointsWin32,n[o].points+=e.pointsLoss32))}),Object.values(n).forEach(e=>{e.setsDiff=e.setsWon-e.setsLost,e.setsQuotient=0===e.setsLost?e.setsWon:parseFloat((e.setsWon/e.setsLost).toFixed(3)),e.pointsDiff=e.pointsWon-e.pointsLost,e.pointsQuotient=0===e.pointsLost?e.pointsWon:parseFloat((e.pointsWon/e.pointsLost).toFixed(3))});let a=Object.values(n).sort((e,t)=>e.points!==t.points?t.points-e.points:e.setsDiff!==t.setsDiff?t.setsDiff-e.setsDiff:e.setsQuotient!==t.setsQuotient?t.setsQuotient-e.setsQuotient:e.directComparisonWins!==t.directComparisonWins?t.directComparisonWins-e.directComparisonWins:e.pointsDiff!==t.pointsDiff?t.pointsDiff-e.pointsDiff:e.pointsQuotient!==t.pointsQuotient?t.pointsQuotient-e.pointsQuotient:t.won-e.won);return r.NextResponse.json(a)}catch(e){return console.error("Error calculating league table:",e),r.NextResponse.json({message:"Fehler bei der Berechnung der Tabelle"},{status:500})}}let l=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/leagues/[id]/table/route",pathname:"/api/leagues/[id]/table",filename:"route",bundlePath:"app/api/leagues/[id]/table/route"},resolvedPagePath:"/Users/schne1s/Documents/KI_PAGE/src/app/api/leagues/[id]/table/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:c,serverHooks:m}=l,f="/api/leagues/[id]/table/route";function h(){return(0,a.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:c})}},83493:(e,t,s)=>{s.d(t,{Z:()=>n,_:()=>i});let o=require("@prisma/client"),i=globalThis.prisma??new o.PrismaClient({}),n=i}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),o=t.X(0,[9276,5972],()=>s(87848));module.exports=o})();